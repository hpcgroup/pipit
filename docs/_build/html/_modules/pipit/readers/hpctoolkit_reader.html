<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipit.readers.hpctoolkit_reader &mdash; pipit 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/pipit.html">Pipit API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pipit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pipit.readers.hpctoolkit_reader</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pipit.readers.hpctoolkit_reader</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2022-2023 Parallel Software and Systems Group, University of</span>
<span class="c1"># Maryland. See the top-level LICENSE file for details.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pipit.trace</span>
<span class="kn">from</span> <span class="nn">pipit.graph</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Node</span>


<div class="viewcode-block" id="MetaReader"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.MetaReader">[docs]</a><span class="k">class</span> <span class="nc">MetaReader</span><span class="p">:</span>
    <span class="c1"># adds new context id and return new nid</span>
    <span class="k">def</span> <span class="nf">_add_context_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nid_to_ctx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_nid</span><span class="p">]</span> <span class="o">=</span> <span class="n">context_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_nid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_nid</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_location</span><span class="p">):</span>
        <span class="c1"># open the file to ready in binary mode (rb)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>

        <span class="c1"># setting necessary read options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="o">=</span> <span class="s2">&quot;little&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ASCII&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_nid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nid_to_ctx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># The meta.db header consists of the common .db header and n sections.</span>
        <span class="c1"># We&#39;re going to do a little set up work, so that&#39;s easy to change if</span>
        <span class="c1"># any revisions change the orders.</span>

        <span class="c1"># We&#39;re are going to specify 2 maps:</span>
        <span class="c1">#   - One dictionary maps the section name to an index</span>
        <span class="c1">#       (which follows the order that the sections are seen</span>
        <span class="c1">#        in the meta.db header)</span>
        <span class="c1">#   - The second dictionary maps the section name to a</span>
        <span class="c1">#       function that reads the section. Each function is defined</span>
        <span class="c1">#       as __read_&lt;section_name&gt;_section(self, section_pointer: int,</span>
        <span class="c1">#       section_size: int) -&gt; None</span>

        <span class="c1"># Here I&#39;m mapping the section name to it&#39;s order in the meta.db header</span>
        <span class="n">header_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;General Properties&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;Identifier Names&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;Performance Metrics&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;Context Tree&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;Common String Table&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;Load Modules&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;Source Files&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s2">&quot;Functions&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Now let&#39;s create a function to section map</span>
        <span class="n">reader_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;General Properties&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_general_properties_section</span><span class="p">,</span>
            <span class="s2">&quot;Common String Table&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_common_string_table_section</span><span class="p">,</span>
            <span class="s2">&quot;Source Files&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_source_files_section</span><span class="p">,</span>
            <span class="s2">&quot;Functions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_functions_section</span><span class="p">,</span>
            <span class="s2">&quot;Load Modules&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_load_modules_section</span><span class="p">,</span>
            <span class="s2">&quot;Context Tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_context_tree_section</span><span class="p">,</span>
            <span class="s2">&quot;Identifier Names&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_identifier_names_section</span><span class="p">,</span>
            <span class="s2">&quot;Performance Metrics&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_performance_metrics_section</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Another thing thing that we should consider is the order to read the sections.</span>
        <span class="c1"># Here is a list of section references (x -&gt; y means x references y)</span>
        <span class="c1">#   - &quot;Source Files&quot;    -&gt;  &quot;Common String Table&quot;</span>
        <span class="c1">#   - &quot;Functions&quot;       -&gt;  &quot;Common String Table&quot;</span>
        <span class="c1">#   - &quot;Context Tree&quot;    -&gt;  &quot;Common String Table&quot;</span>
        <span class="c1">#   - &quot;Load Modules&quot;    -&gt;  &quot;Common String Table&quot;</span>
        <span class="c1">#   - &quot;Functions&quot;       -&gt;  &quot;Source Files&quot;</span>
        <span class="c1">#   - &quot;Context Tree&quot;    -&gt;  &quot;Functions&quot;</span>
        <span class="c1">#   - &quot;Context Tree&quot;    -&gt;  &quot;Source Files&quot;</span>
        <span class="c1">#   - &quot;Functions&quot;       -&gt;  &quot;Load Modules&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Thus we want to keep this order when reading sections:</span>
        <span class="c1"># &quot;Common String Table&quot; -&gt; &quot;Source Files&quot; -&gt; &quot;Functions&quot; -&gt; &quot;Context Tree&quot;, and</span>
        <span class="c1"># &quot;Common String Table -&gt; &quot;Load Modules&quot; -&gt; &quot;Context Tree&quot;</span>
        <span class="c1"># Here I&#39;m specifying the order of reading the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Common String Table&quot;</span><span class="p">,</span>
            <span class="s2">&quot;General Properties&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Source Files&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Load Modules&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Functions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Context Tree&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Identifier Names&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Performance Metrics&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Let&#39;s make sure that we include every section in the read order and reader_map</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">reader_map</span>
        <span class="p">)</span>

        <span class="c1"># Now to the actual reading of the meta.db file</span>

        <span class="c1"># reading the meta.db header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_common_header</span><span class="p">()</span>

        <span class="c1"># now let&#39;s read all the sections</span>
        <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">:</span>
            <span class="n">section_index</span> <span class="o">=</span> <span class="n">header_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_reader</span> <span class="o">=</span> <span class="n">reader_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_reader</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">,</span> <span class="n">section_size</span><span class="p">)</span>

<div class="viewcode-block" id="MetaReader.get_information_from_context_id"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.MetaReader.get_information_from_context_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_information_from_context_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;string_index&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;string_index&quot;</span><span class="p">]],</span>
                <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;lexical_type&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;loop_type&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># return self.common_strings[context[&quot;string_index&quot;]]</span>
        <span class="c1"># context = {&quot;relation&quot;: relation, &quot;lexical_type&quot;: lexical_type, \</span>
        <span class="c1">#                &quot;function_index&quot;: function_index, \</span>
        <span class="c1">#                &quot;source_file_index&quot;: source_file_index, \</span>
        <span class="c1">#                &quot;source_file_line&quot;: source_file_line, \</span>
        <span class="c1">#                &quot;load_module_index&quot;:load_module_index, \</span>
        <span class="c1">#                &quot;load_module_offset&quot;: load_module_offset}</span>

        <span class="n">load_module_index</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;load_module_index&quot;</span><span class="p">]</span>
        <span class="n">source_file_index</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;source_file_index&quot;</span><span class="p">]</span>
        <span class="n">source_file_line</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;source_file_line&quot;</span><span class="p">]</span>
        <span class="n">function_index</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;function_index&quot;</span><span class="p">]</span>
        <span class="n">lexical_type</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;lexical_type&quot;</span><span class="p">]</span>

        <span class="n">source_file_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">module_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">function_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">file_line</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">loop_type</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">lexical_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># loop construct</span>
            <span class="n">function_string</span> <span class="o">=</span> <span class="s2">&quot;loop&quot;</span>
            <span class="n">loop_type</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">function_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The function map</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions_list</span><span class="p">[</span><span class="n">function_index</span><span class="p">]</span>
            <span class="c1"># current_function_map = {&quot;string_index&quot;: function_name_index, \</span>
            <span class="c1">#                         &quot;source_line&quot;: source_line,</span>
            <span class="c1">#                         &quot;load_modules_index&quot;: load_module_index, \</span>
            <span class="c1">#                         &quot;source_file_index&quot;: source_file_index}</span>

            <span class="c1"># getting function name</span>
            <span class="n">function_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="n">function</span><span class="p">[</span><span class="s2">&quot;string_index&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># function is unkown</span>
            <span class="n">function_string</span> <span class="o">=</span> <span class="s2">&quot;&lt;unkown function&gt;&quot;</span>

        <span class="k">if</span> <span class="n">load_module_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">load_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_list</span><span class="p">[</span><span class="n">load_module_index</span><span class="p">]</span>
            <span class="n">module_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="n">load_module</span><span class="p">[</span><span class="s2">&quot;string_index&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">source_file_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files_list</span><span class="p">[</span><span class="n">source_file_index</span><span class="p">]</span>
            <span class="n">source_file_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="n">source_file</span><span class="p">[</span><span class="s2">&quot;string_index&quot;</span><span class="p">]]</span>
        <span class="c1"># if function_index is not None:</span>
        <span class="c1">#     function = self.functions_list[function_index]</span>
        <span class="c1">#     function_string = self.common_strings[function[&quot;string_index&quot;]]</span>
        <span class="k">if</span> <span class="n">source_file_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_file_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">module_string</span><span class="p">,</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">source_file_string</span><span class="p">,</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="n">function_string</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">file_line</span><span class="p">,</span>
            <span class="s2">&quot;lexical_type&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;lexical_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;relation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;loop_type&quot;</span><span class="p">:</span> <span class="n">loop_type</span><span class="p">,</span>
        <span class="p">}</span></div>

    <span class="k">def</span> <span class="nf">__read_common_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads common .db file header version 4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read Magic identifier (&quot;HPCPROF-tracedb_&quot;)</span>
        <span class="c1"># first ten buyes are HPCTOOLKIT in ASCII</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s2">&quot;HPCTOOLKIT&quot;</span>

        <span class="c1"># next 4 bytes (u8) are the &quot;Specific format identifier&quot;</span>
        <span class="n">format_identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">format_identifier</span> <span class="o">==</span> <span class="s2">&quot;meta&quot;</span>

        <span class="c1"># next byte (u8) contains the &quot;Common major version, currently 4&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># next byte (u8) contains the &quot;Specific minor version&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># In the header each section is given 16 bytes:</span>
        <span class="c1">#   - First 8 bytes specify the total size of the section (in bytes)</span>
        <span class="c1">#   - Last 8 bytes specify a pointer to the beggining of the section</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_general_properties_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reads the general properties of the trace.</span>
<span class="sd">        Sets:</span>

<span class="sd">        self.database_title: Title of the database. May be provided by the user.</span>

<span class="sd">        self.database_description: Human-readable Markdown description of the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># go to the right spot in the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>
        <span class="n">title_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="n">description_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_string</span><span class="p">(</span><span class="n">title_pointer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_string</span><span class="p">(</span><span class="n">description_pointer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_common_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Given the file pointer to find string, returns the string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">string_pointer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span><span class="n">string_pointer</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__read_common_string_table_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Let&#39;s go to the section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># We know that this section is just a densely packed list of strings,</span>
        <span class="c1"># seperated by the null character</span>
        <span class="c1"># So to create a list of these strings, we&#39;ll read them all into one string then</span>
        <span class="c1"># split them by the null character</span>

        <span class="c1"># Reading entire section into a string</span>
        <span class="n">total_section</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">section_size</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>

        <span class="c1"># Splitting entire section into list of strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Now we are creating a map between the original location to the string</span>
        <span class="c1"># to the index of the string in self.common_strings.</span>
        <span class="c1"># This is because we are passed pointers to find the string in other sections</span>
        <span class="n">pointer_index</span> <span class="o">=</span> <span class="n">section_pointer</span>
        <span class="c1"># pointer_index = 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span><span class="n">pointer_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">pointer_index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">common_strings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__get_load_modules_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load_module_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the pointer to where the file would exists in meta.db,</span>
<span class="sd">        returns the index of the file in self.source_files_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">load_module_pointer</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_pointer</span>
        <span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_module_size</span>

    <span class="k">def</span> <span class="nf">__read_load_modules_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the &quot;Load Modules&quot; Section of meta.db.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go to the right spot in meta.db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># Load modules used in this database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Number of load modules listed in this section (u32)</span>
        <span class="n">num_load_modules</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Size of a Load Module Specification, currently 16 (u16)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_module_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># Going to store file&#39;s path in self.load_modules_list.</span>
        <span class="c1"># Each will contain the index of file&#39;s path string in</span>
        <span class="c1"># self.common_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_load_modules</span><span class="p">):</span>
            <span class="n">current_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_module_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>

            <span class="c1"># Flags -- Reserved for future use (u32)</span>
            <span class="c1"># flags = int.from_bytes(</span>
            <span class="c1">#     self.file.read(4), byteorder=self.byte_order, signed=self.signed</span>
            <span class="c1"># )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1"># empty space that we need to skip</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1"># Full path to the associated application binary</span>
            <span class="n">path_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">module_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;string_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span><span class="n">path_pointer</span><span class="p">]}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_modules_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to read a string from the file starting at the file_pointer</span>
<span class="sd">        and ending at the first occurence of the null character</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">file_pointer</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">read</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">read</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="n">read</span>
        <span class="k">return</span> <span class="n">name</span>

<div class="viewcode-block" id="MetaReader.get_identifier_name"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.MetaReader.get_identifier_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_identifier_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the identifier name, given the kind</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier_names</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__read_identifier_names_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads &quot;Identifier Names&quot; Section and Identifier Name strings in self.names_list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># go to correct section of file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># Human-readable names for Identifier kinds</span>
        <span class="n">names_pointer_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Number of names listed in this section</span>
        <span class="n">num_names</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">identifier_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">names_pointer_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">names_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identifier_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_string</span><span class="p">(</span><span class="n">names_pointer</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__read_performance_metrics_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__get_function_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the pointer to where the function would exists in meta.db,</span>
<span class="sd">        returns the index of the file in self.functions_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">function_pointer</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions_array_pointer</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_size</span>
        <span class="k">assert</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">functions_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">__read_functions_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the &quot;Functions&quot; section of meta.db.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># go to correct section in file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functions_array_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="n">num_functions</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functions_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_functions</span><span class="p">):</span>
            <span class="n">current_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions_array_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>
            <span class="n">function_name_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">modules_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">modules_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">file_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">source_line</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="c1"># flags = int.from_bytes(</span>
            <span class="c1">#     self.file.read(4), byteorder=self.byte_order, signed=self.signed</span>
            <span class="c1"># )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">source_file_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">load_module_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">function_name_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">function_name_pointer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">function_name_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span>
                    <span class="n">function_name_pointer</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="n">modules_pointer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">load_module_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_load_modules_index</span><span class="p">(</span><span class="n">modules_pointer</span><span class="p">)</span>
                <span class="c1"># currently ignoring offset -- no idea how that&#39;s used</span>
            <span class="k">if</span> <span class="n">file_pointer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">source_file_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_source_file_index</span><span class="p">(</span><span class="n">file_pointer</span><span class="p">)</span>

            <span class="n">current_function_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;string_index&quot;</span><span class="p">:</span> <span class="n">function_name_index</span><span class="p">,</span>
                <span class="s2">&quot;source_line&quot;</span><span class="p">:</span> <span class="n">source_line</span><span class="p">,</span>
                <span class="s2">&quot;load_modules_index&quot;</span><span class="p">:</span> <span class="n">load_module_index</span><span class="p">,</span>
                <span class="s2">&quot;source_file_index&quot;</span><span class="p">:</span> <span class="n">source_file_index</span><span class="p">,</span>
                <span class="s2">&quot;load_modules_offset&quot;</span><span class="p">:</span> <span class="n">modules_offset</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">functions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_function_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_source_file_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_file_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the pointer to where the file would exists in meta.db,</span>
<span class="sd">        returns the index of the file in self.source_files_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source_file_pointer</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files_pointer</span>
        <span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file_size</span>
        <span class="k">assert</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_files_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">__read_source_files_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the &quot;Source Files&quot; Section of meta.db.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># Source files used in this database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_files_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># Number of source files listed in this section (u32)</span>
        <span class="n">num_files</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># Size of a Source File Specification, currently 16 (u16)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_file_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># Looping through individual files to get there information now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_files_pointer</span><span class="p">)</span>

        <span class="c1"># Going to store file&#39;s path in self.files_list.</span>
        <span class="c1"># Each will contain the index of file&#39;s path string in</span>
        <span class="c1"># self.common_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_files_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_files</span><span class="p">):</span>
            <span class="c1"># Reading information about each individual source file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_files_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file_size</span><span class="p">))</span>

            <span class="c1"># flag = int.from_bytes(</span>
            <span class="c1">#     self.file.read(4), byteorder=self.byte_order, signed=self.signed</span>
            <span class="c1"># )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1"># empty space that we need to skip</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1"># Path to the source file. Absolute, or relative to the root database</span>
            <span class="c1"># directory. The string pointed to by pPath is completely within the</span>
            <span class="c1"># Common String Table section, including the terminating NUL byte.</span>
            <span class="n">file_path_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">string_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span><span class="n">file_path_pointer</span><span class="p">]</span>
            <span class="n">source_file_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;string_index&quot;</span><span class="p">:</span> <span class="n">string_index</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source_file_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_context_tree_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the &quot;Context Tree&quot; section of meta.db.</span>

<span class="sd">        Loops and calls __read_single_entry_point with the correct pointer to read</span>
<span class="sd">        the correct entry and add it to the CCT.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cct</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Reading &quot;Context Tree&quot; section header</span>

        <span class="c1"># make sure we&#39;re in the right spot of the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># ({Entry}[nEntryPoints]*)</span>
        <span class="n">entry_points_array_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># (u16)</span>
        <span class="n">num_entry_points</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># (u8)</span>
        <span class="n">entry_point_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_entry_points</span><span class="p">):</span>
            <span class="n">current_pointer</span> <span class="o">=</span> <span class="n">entry_points_array_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">entry_point_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_single_entry_point</span><span class="p">(</span><span class="n">current_pointer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_single_entry_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_point_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads single (root) context entry.</span>

<span class="sd">        Reads the correct entry and adds it to the CCT.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">entry_point_pointer</span><span class="p">)</span>

        <span class="c1"># Reading information about child contexts</span>
        <span class="c1"># Total size of *pChildren (I call pChildren children_pointer), in bytes (u64)</span>
        <span class="n">children_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Pointer to the array of child contexts</span>
        <span class="n">children_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># Reading information about this context</span>
        <span class="c1"># Unique identifier for this context (u32)</span>
        <span class="n">context_id</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Type of entry point used here (u16)</span>
        <span class="c1"># entry_point_type = int.from_bytes(</span>
        <span class="c1">#     self.file.read(2), byteorder=self.byte_order, signed=self.signed</span>
        <span class="c1"># )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># next 2 bytes are blank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Human-readable name for the entry point</span>
        <span class="n">pretty_name_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># map context for this context</span>
        <span class="n">string_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_string_index_map</span><span class="p">[</span><span class="n">pretty_name_pointer</span><span class="p">]</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;lexical_type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;function_index&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;source_file_index&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;source_file_line&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;load_module_index&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;load_module_offset&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;string_index&quot;</span><span class="p">:</span> <span class="n">string_index</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># context = {&quot;string_index&quot;: string_index}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>
        <span class="c1"># Create Node for this context</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_context_id</span><span class="p">(</span><span class="n">context_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Adding the Node to the CCT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cct</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

        <span class="c1"># Reading the children contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_children_contexts</span><span class="p">(</span><span class="n">children_pointer</span><span class="p">,</span> <span class="n">children_size</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">context_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_children_contexts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context_array_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">total_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parent_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="n">parent_context_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive function to read all child contexts and add it to the CCT</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">total_size</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">context_array_pointer</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">context_array_pointer</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">total_size</span><span class="p">:</span>
            <span class="c1"># Reading information about child contexts (as in the children of</span>
            <span class="c1"># this context)</span>
            <span class="c1"># Total size of *pChildren (I call pChildren children_pointer),</span>
            <span class="c1"># in bytes (u64)</span>
            <span class="n">children_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="c1"># Pointer to the array of child contexts</span>
            <span class="n">children_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">8</span>

            <span class="c1"># Reading information about this context</span>
            <span class="c1"># Unique identifier for this context (u32)</span>
            <span class="n">context_id</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="c1"># Reading flags (u8)</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Relation this context has with its parent (u8)</span>
            <span class="n">relation</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Type of lexical context represented (u8)</span>
            <span class="n">lexical_type</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Size of flex, in u8[8] &quot;words&quot; (bytes / 8) (u8)</span>
            <span class="n">num_flex_words</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Bitmask for defining propagation scopes (u16)</span>
            <span class="c1"># propogation = int.from_bytes(</span>
            <span class="c1">#     self.file.read(2), byteorder=self.byte_order, signed=self.signed</span>
            <span class="c1"># )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="c1"># Empty space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">6</span>

            <span class="c1"># reading flex</span>
            <span class="n">flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">num_flex_words</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">num_flex_words</span>

            <span class="n">function_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">source_file_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">source_file_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">load_module_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">load_module_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># flex is u8[8][num_flex],</span>
            <span class="c1"># meaning that one flex word is 8 bytes or u64</span>

            <span class="c1"># Bit 0: hasFunction. If 1, the following sub-fields of flex are present:</span>
            <span class="c1">#   flex[0]: FS* pFunction: Function associated with this context</span>
            <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sub_flex</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="n">flex</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">flex</span> <span class="o">=</span> <span class="n">flex</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
                <span class="n">function_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_function_index</span><span class="p">(</span><span class="n">sub_flex</span><span class="p">)</span>

            <span class="c1"># Bit 1: hasSrcLoc. If 1, the following sub-fields of flex are present:</span>
            <span class="c1">#   flex[1]: SFS* pFile: Source file associated with this context</span>
            <span class="c1">#   flex[2]: u32 line: Associated source line in pFile</span>
            <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sub_flex_1</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="n">flex</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">sub_flex_2</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="n">flex</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">flex</span> <span class="o">=</span> <span class="n">flex</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
                <span class="n">source_file_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_source_file_index</span><span class="p">(</span><span class="n">sub_flex_1</span><span class="p">)</span>
                <span class="n">source_file_line</span> <span class="o">=</span> <span class="n">sub_flex_2</span>

            <span class="c1"># Bit 2: hasPoint. If 1, the following sub-fields of flex are present:</span>
            <span class="c1">#   flex[3]: LMS* pModule: Load module associated with this context</span>
            <span class="c1">#   flex[4]: u64 offset: Associated byte offset in *pModule</span>
            <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sub_flex_1</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="n">flex</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">sub_flex_2</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="n">flex</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">flex</span> <span class="o">=</span> <span class="n">flex</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
                <span class="n">load_module_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_load_modules_index</span><span class="p">(</span><span class="n">sub_flex_1</span><span class="p">)</span>
                <span class="n">load_module_offset</span> <span class="o">=</span> <span class="n">sub_flex_2</span>

            <span class="c1"># Now we take a look at the relationship and type of the context</span>
            <span class="k">if</span> <span class="n">lexical_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">lexical_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># source line type or single line instruction</span>
                <span class="c1"># meaning we don&#39;t want to create a node for this</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_node</span>
                <span class="n">next_parent_node</span> <span class="o">=</span> <span class="n">parent_node</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># otherwise we do want to create a node</span>
                <span class="c1"># Creating Node for this context</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_context_id</span><span class="p">(</span><span class="n">context_id</span><span class="p">),</span> <span class="n">parent_node</span><span class="p">)</span>

                <span class="c1"># Connecting this node to the parent node</span>
                <span class="n">parent_node</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="c1"># Adding this node to the graph</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

                <span class="k">if</span> <span class="n">lexical_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># function call</span>
                    <span class="c1"># this means that information about the</span>
                    <span class="c1"># source file and module are with the parent</span>
                    <span class="n">parent_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_map</span><span class="p">[</span><span class="n">parent_context_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">&quot;string_index&quot;</span> <span class="ow">in</span> <span class="n">parent_information</span>
                        <span class="ow">and</span> <span class="n">function_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="c1"># This means that the parent is the root, and it&#39;s</span>
                        <span class="c1"># information is useless</span>
                        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions_list</span><span class="p">[</span><span class="n">function_index</span><span class="p">]</span>
                        <span class="c1"># Getting source file line</span>
                        <span class="n">source_file_line</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="s2">&quot;source_line&quot;</span><span class="p">]</span>
                        <span class="c1"># Getting source file name</span>
                        <span class="n">source_file_index</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="s2">&quot;source_file_index&quot;</span><span class="p">]</span>
                        <span class="c1"># Getting Load Module Name</span>
                        <span class="n">load_module_index</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="s2">&quot;load_modules_index&quot;</span><span class="p">]</span>
                        <span class="c1"># Getting Load Module Offset</span>

                        <span class="n">load_module_offset</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="s2">&quot;load_modules_offset&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">source_file_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">source_file_index</span> <span class="o">=</span> <span class="n">parent_information</span><span class="p">[</span><span class="s2">&quot;source_file_index&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">source_file_line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">source_file_line</span> <span class="o">=</span> <span class="n">parent_information</span><span class="p">[</span><span class="s2">&quot;source_file_line&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">load_module_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">load_module_index</span> <span class="o">=</span> <span class="n">parent_information</span><span class="p">[</span><span class="s2">&quot;load_module_index&quot;</span><span class="p">]</span>
                            <span class="n">load_module_offset</span> <span class="o">=</span> <span class="n">parent_information</span><span class="p">[</span>
                                <span class="s2">&quot;load_module_offset&quot;</span>
                            <span class="p">]</span>
                <span class="n">next_parent_node</span> <span class="o">=</span> <span class="n">node</span>

            <span class="c1"># creating a map for this context</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
                <span class="s2">&quot;lexical_type&quot;</span><span class="p">:</span> <span class="n">lexical_type</span><span class="p">,</span>
                <span class="s2">&quot;function_index&quot;</span><span class="p">:</span> <span class="n">function_index</span><span class="p">,</span>
                <span class="s2">&quot;source_file_index&quot;</span><span class="p">:</span> <span class="n">source_file_index</span><span class="p">,</span>
                <span class="s2">&quot;source_file_line&quot;</span><span class="p">:</span> <span class="n">source_file_line</span><span class="p">,</span>
                <span class="s2">&quot;load_module_index&quot;</span><span class="p">:</span> <span class="n">load_module_index</span><span class="p">,</span>
                <span class="s2">&quot;load_module_offset&quot;</span><span class="p">:</span> <span class="n">load_module_offset</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">context_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>

            <span class="c1"># recursively call this function to add more children</span>
            <span class="n">return_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_children_contexts</span><span class="p">(</span>
                <span class="n">children_pointer</span><span class="p">,</span> <span class="n">children_size</span><span class="p">,</span> <span class="n">next_parent_node</span><span class="p">,</span> <span class="n">context_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">return_address</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProfileReader"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.ProfileReader">[docs]</a><span class="k">class</span> <span class="nc">ProfileReader</span><span class="p">:</span>
    <span class="c1"># class to read self.data from profile.db file</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_location</span><span class="p">,</span> <span class="n">meta_reader</span><span class="p">):</span>
        <span class="c1"># gets the pi_ptr variable to be able to read the identifier tuples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="p">:</span> <span class="n">MetaReader</span> <span class="o">=</span> <span class="n">meta_reader</span>

        <span class="c1"># open the file to ready in binary mode (rb)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>

        <span class="c1"># setting necessary read options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="o">=</span> <span class="s2">&quot;little&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ASCII&quot;</span>

        <span class="c1"># The profile.db header consists of the common .db header and n sections.</span>
        <span class="c1"># We&#39;re going to do a little set up work, so that&#39;s easy to change if</span>
        <span class="c1"># any revisions change the orders.</span>

        <span class="c1"># We&#39;re are going to specify 2 maps:</span>
        <span class="c1">#   - One dictionary maps the section name to an index</span>
        <span class="c1">#       (which follows the order that the sections are seen</span>
        <span class="c1">#        in the profile.db header)</span>
        <span class="c1">#   - The second dictionary maps the section name to a</span>
        <span class="c1">#       function that reads the section. Each function is defined</span>
        <span class="c1">#       as __read_&lt;section_name&gt;_section(self, section_pointer: int,</span>
        <span class="c1">#       section_size: int) -&gt; None</span>

        <span class="c1"># Here I&#39;m mapping the section name to it&#39;s order in the profile.db header</span>
        <span class="n">header_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Profiles Information&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Hierarchical Identifier Tuples&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># Now let&#39;s create a function to section map</span>
        <span class="n">reader_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Profiles Information&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_profiles_information_section</span><span class="p">,</span>
            <span class="s2">&quot;Hierarchical Identifier Tuples&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_hit_section</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Another thing thing that we should consider is the order to read the sections.</span>
        <span class="c1"># Here is a list of section references (x -&gt; y means x references y)</span>
        <span class="c1">#   - &quot;Profiles Information&quot; -&gt; &quot;Hierarchical Identifier Tuples&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Thus we want to keep this order when reading sections:</span>
        <span class="c1"># &quot;Profiles Information&quot; -&gt; &quot;Hierarchical Identifier Tuples&quot;</span>
        <span class="c1"># Here I&#39;m specifying the order of reading the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hierarchical Identifier Tuples&quot;</span><span class="p">,</span> <span class="s2">&quot;Profiles Information&quot;</span><span class="p">]</span>

        <span class="c1"># Let&#39;s make sure that we include every section in the read order and reader_map</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">reader_map</span>
        <span class="p">)</span>

        <span class="c1"># Now to the actual reading of the profile.db file</span>

        <span class="c1"># reading the profile.db header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_common_header</span><span class="p">()</span>

        <span class="c1"># now let&#39;s read all the sections</span>
        <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">:</span>
            <span class="n">section_index</span> <span class="o">=</span> <span class="n">header_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_reader</span> <span class="o">=</span> <span class="n">reader_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_reader</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">,</span> <span class="n">section_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_profiles_information_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads Profile Information section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># Description for each profile (u64)</span>
        <span class="n">profiles_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Number of profiles listed in this section (u32)</span>
        <span class="n">num_profiles</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Size of a {PI} structure, currently 40 (u8)</span>
        <span class="n">profile_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">profile_info_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_profiles</span><span class="p">):</span>
            <span class="n">file_index</span> <span class="o">=</span> <span class="n">profiles_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">profile_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">file_index</span><span class="p">)</span>
            <span class="c1"># Header for the values for this profile</span>
            <span class="n">psvb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
            <span class="c1"># Identifier tuple for this profile</span>
            <span class="n">hit_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="c1"># (u32)</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>
            <span class="n">profile_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hit_pointer&quot;</span><span class="p">:</span> <span class="n">hit_pointer</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">flags</span><span class="p">,</span> <span class="s2">&quot;psvb&quot;</span><span class="p">:</span> <span class="n">psvb</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile_map</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hit_pointer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># this is a summary profile</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summary_profile_index</span> <span class="o">=</span> <span class="n">i</span>

<div class="viewcode-block" id="ProfileReader.get_hit_from_profile"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.ProfileReader.get_hit_from_profile">[docs]</a>    <span class="k">def</span> <span class="nf">get_hit_from_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_info_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">hit_pointer</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;hit_pointer&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hit_pointer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_map</span><span class="p">[</span><span class="n">hit_pointer</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_info_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_profile_index</span><span class="p">]</span>
            <span class="n">hit_pointer</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;hit_pointer&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_map</span><span class="p">[</span><span class="n">hit_pointer</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__read_hit_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads Hierarchical Identifier Tuples section of profile.db</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># let&#39;s get to the correct spot in the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hit_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">section_pointer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">section_size</span><span class="p">:</span>
            <span class="c1"># hit pointer</span>
            <span class="n">hit_pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

            <span class="c1"># Number of identifications in this tuple (u16)</span>
            <span class="n">num_tuples</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>

            <span class="c1"># empty space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

            <span class="c1"># Identifications for an application thread</span>
            <span class="c1"># Read H.I.T.s</span>
            <span class="n">tuples_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tuples</span><span class="p">):</span>
                <span class="c1"># One of the values listed in the profile.db</span>
                <span class="c1"># Identifier Names section. (u8)</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="c1"># empty space</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># flag</span>
                <span class="c1"># flags = int.from_bytes(</span>
                <span class="c1">#     self.file.read(2), byteorder=self.byte_order, signed=self.signed</span>
                <span class="c1"># )</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># Logical identifier value, may be arbitrary but dense towards 0. (u32)</span>
                <span class="c1"># logical_id = int.from_bytes(</span>
                <span class="c1">#     self.file.read(4), byteorder=self.byte_order, signed=self.signed</span>
                <span class="c1"># )</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="c1"># Physical identifier value, eg. hostid or PCI bus index. (u64)</span>
                <span class="n">physical_id</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="n">identifier_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">get_identifier_name</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
                <span class="n">tuples_map</span><span class="p">[</span><span class="n">identifier_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">physical_id</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hit_map</span><span class="p">[</span><span class="n">hit_pointer</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__clean_hit</span><span class="p">(</span><span class="n">tuples_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__clean_hit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuples_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="c1"># add None for information not present</span>
        <span class="k">if</span> <span class="s2">&quot;Node&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tuples_map</span><span class="p">:</span>
            <span class="n">tuples_map</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;RANK&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tuples_map</span><span class="p">:</span>
            <span class="n">tuples_map</span><span class="p">[</span><span class="s2">&quot;RANK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;THREAD&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tuples_map</span><span class="p">:</span>
            <span class="n">tuples_map</span><span class="p">[</span><span class="s2">&quot;THREAD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;CORE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tuples_map</span><span class="p">:</span>
            <span class="n">tuples_map</span><span class="p">[</span><span class="s2">&quot;CORE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">tuples_map</span>

    <span class="k">def</span> <span class="nf">__read_common_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads common .db file header version 4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read Magic identifier (&quot;HPCPROF-tracedb_&quot;)</span>
        <span class="c1"># first ten buyes are HPCTOOLKIT in ASCII</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s2">&quot;HPCTOOLKIT&quot;</span>

        <span class="c1"># next 4 bytes (u8) are the &quot;Specific format identifier&quot;</span>
        <span class="n">format_identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">format_identifier</span> <span class="o">==</span> <span class="s2">&quot;prof&quot;</span>

        <span class="c1"># next byte (u8) contains the &quot;Common major version, currently 4&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># next byte (u8) contains the &quot;Specific minor version&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># In the header each section is given 16 bytes:</span>
        <span class="c1">#   - First 8 bytes specify the total size of the section (in bytes)</span>
        <span class="c1">#   - Last 8 bytes specify a pointer to the beggining of the section</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="TraceReader"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.TraceReader">[docs]</a><span class="k">class</span> <span class="nc">TraceReader</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">meta_reader</span><span class="p">:</span> <span class="n">MetaReader</span><span class="p">,</span> <span class="n">profile_reader</span><span class="p">:</span> <span class="n">ProfileReader</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># open file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span> <span class="o">=</span> <span class="n">meta_reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_reader</span> <span class="o">=</span> <span class="n">profile_reader</span>

        <span class="c1"># setting necessary read options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="o">=</span> <span class="s2">&quot;little&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ASCII&quot;</span>

        <span class="c1"># The trace.db header consists of the common .db header and n sections.</span>
        <span class="c1"># We&#39;re going to do a little set up work, so that&#39;s easy to change if</span>
        <span class="c1"># any revisions change the orders.</span>

        <span class="c1"># We&#39;re are going to specify 2 maps:</span>
        <span class="c1">#   - One dictionary maps the section name to an index</span>
        <span class="c1">#       (which follows the order that the sections are seen</span>
        <span class="c1">#        in the trace.db header)</span>
        <span class="c1">#   - The second dictionary maps the section name to a</span>
        <span class="c1">#       function that reads the section. Each function is defined</span>
        <span class="c1">#       as __read_&lt;section_name&gt;_section(self, section_pointer: int,</span>
        <span class="c1">#       section_size: int) -&gt; None</span>

        <span class="c1"># Here I&#39;m mapping the section name to it&#39;s order in the trace.db header</span>
        <span class="n">header_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Context Trace Headers&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># Now let&#39;s create a function to section map</span>
        <span class="n">reader_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Context Trace Headers&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_trace_headers_section</span><span class="p">}</span>

        <span class="c1"># Another thing thing that we should consider is the order to read the sections.</span>
        <span class="c1"># Here I&#39;m specifying the order of reading the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Context Trace Headers&quot;</span><span class="p">]</span>

        <span class="c1"># Let&#39;s make sure that we include every section in the read order and reader_map</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">header_map</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">reader_map</span>
        <span class="p">)</span>

        <span class="c1"># Now to the actual reading of the trace.db file</span>

        <span class="c1"># reading the trace.db header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_common_header</span><span class="p">()</span>

        <span class="c1"># now let&#39;s read all the sections</span>
        <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">:</span>
            <span class="n">section_index</span> <span class="o">=</span> <span class="n">header_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_pointer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="p">[</span><span class="n">section_index</span><span class="p">]</span>
            <span class="n">section_reader</span> <span class="o">=</span> <span class="n">reader_map</span><span class="p">[</span><span class="n">section_name</span><span class="p">]</span>
            <span class="n">section_reader</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">,</span> <span class="n">section_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_common_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads common .db file header version 4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read Magic identifier (&quot;HPCPROF-tracedb_&quot;)</span>
        <span class="c1"># first ten buyes are HPCTOOLKIT in ASCII</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s2">&quot;HPCTOOLKIT&quot;</span>

        <span class="c1"># next 4 bytes (u8) are the &quot;Specific format identifier&quot;</span>
        <span class="n">format_identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">format_identifier</span> <span class="o">==</span> <span class="s2">&quot;trce&quot;</span>

        <span class="c1"># next byte (u8) contains the &quot;Common major version, currently 4&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># next byte (u8) contains the &quot;Specific minor version&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_version</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># In the header each section is given 16 bytes:</span>
        <span class="c1">#   - First 8 bytes specify the total size of the section (in bytes)</span>
        <span class="c1">#   - Last 8 bytes specify a pointer to the beggining of the section</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_order</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section_pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_trace_headers_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">section_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">section_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reader Context Trace Headers section of trace.db</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get to the right place in the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">section_pointer</span><span class="p">)</span>

        <span class="c1"># Header for each trace (u64)</span>
        <span class="n">trace_headers_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Number of traces listed in this section (u32)</span>
        <span class="n">num_trace_headers</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Size of a {TH} structure, currently 24</span>
        <span class="n">trace_header_size</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="c1"># empty space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Smallest timestamp of the traces listed in *pTraces (u64)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_time_stamp</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Largest timestamp of the traces listed in *pTraces (u64)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_stamp</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Event Type&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Thread&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Process&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Core&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Node&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Source File Name&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Source File Line Number&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Calling Context ID&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trace_headers</span><span class="p">):</span>
            <span class="n">header_pointer</span> <span class="o">=</span> <span class="n">trace_headers_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">trace_header_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_single_trace_header</span><span class="p">(</span><span class="n">header_pointer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_single_trace_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_pointer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a single trace header and all trace elements associated with it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">header_pointer</span><span class="p">)</span>

        <span class="c1"># Index of a profile listed in the profile.db (u32)</span>
        <span class="n">profile_index</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_reader</span><span class="o">.</span><span class="n">get_hit_from_profile</span><span class="p">(</span><span class="n">profile_index</span><span class="p">)</span>

        <span class="c1"># empty space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="c1"># Pointer to the first element of the trace line (array)</span>
        <span class="n">start_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>
        <span class="c1"># Pointer to the after-end element of the trace line (array)</span>
        <span class="n">end_pointer</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_pointer</span><span class="p">)</span>

        <span class="c1"># setting up some variables</span>
        <span class="n">last_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># refers to the previous context id</span>
        <span class="n">last_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># refers to the node associated with the last context</span>
        <span class="n">context_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># refers to the current context id</span>
        <span class="n">current_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span>  <span class="c1"># refers to the current node associated with the current context id</span>
        <span class="p">)</span>

        <span class="c1"># refers to the least common ancestor between common_node and last_node</span>
        <span class="c1"># as in finding the node that is the parent of both common_node and last_node</span>
        <span class="n">common_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_pointer</span><span class="p">:</span>
            <span class="c1"># Timestamp (nanoseconds since epoch)</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_time_stamp</span>
            <span class="p">)</span>

            <span class="c1"># Sample calling context id (in meta.db)</span>
            <span class="c1"># can use this to get name of function from meta.db</span>
            <span class="c1"># Procedure tab</span>
            <span class="n">context_id</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">context_id</span> <span class="o">==</span> <span class="n">last_id</span><span class="p">:</span>
                <span class="c1"># nothing changed between samples.</span>
                <span class="c1"># means we don&#39;t have to do anything</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">context_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># process is idling</span>
                <span class="n">current_node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># at a new non-idle context</span>
                <span class="n">current_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">node_map</span><span class="p">[</span><span class="n">context_id</span><span class="p">]</span>

            <span class="c1"># First we want to close all the &quot;enter&quot; events from the last sample</span>
            <span class="c1"># that aren&#39;t still running</span>
            <span class="k">if</span> <span class="n">last_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">common_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">common_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">get_intersection</span><span class="p">(</span><span class="n">last_node</span><span class="p">)</span>

                <span class="c1"># closing each &quot;enter&quot; column until we reach the common_node</span>
                <span class="k">while</span> <span class="n">last_node</span> <span class="o">!=</span> <span class="n">common_node</span><span class="p">:</span>
                    <span class="n">curr_ctx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">nid_to_ctx</span><span class="p">[</span><span class="n">last_node</span><span class="o">.</span><span class="n">_pipit_nid</span><span class="p">]</span>
                    <span class="n">context_information</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">get_information_from_context_id</span><span class="p">(</span><span class="n">curr_ctx_id</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;loop_type&quot;</span><span class="p">]:</span>
                        <span class="c1"># HPCViewer only puts loops in CCT, but not trace view, so</span>
                        <span class="c1"># we use a special Loop Enter/Leave event type</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Loop Leave&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Leave&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Process&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;RANK&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Thread&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;THREAD&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Host&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;NODE&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Core&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;CORE&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_node</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Line Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Calling Context ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_ctx_id</span><span class="p">)</span>

                    <span class="n">last_node</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">parent</span>
            <span class="c1"># Now we want to add all the new &quot;enter&quot; events after</span>
            <span class="c1"># the common_node event</span>
            <span class="k">if</span> <span class="n">current_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">common_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">intersect_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">intersect_level</span> <span class="o">=</span> <span class="n">common_node</span><span class="o">.</span><span class="n">get_level</span><span class="p">()</span>
                <span class="n">entry_nodes</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">get_node_list</span><span class="p">(</span><span class="n">intersect_level</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">entry_nodes</span><span class="p">)):</span>
                    <span class="n">entry_node</span> <span class="o">=</span> <span class="n">entry_nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">curr_ctx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">nid_to_ctx</span><span class="p">[</span><span class="n">entry_node</span><span class="o">.</span><span class="n">_pipit_nid</span><span class="p">]</span>
                    <span class="n">context_information</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">get_information_from_context_id</span><span class="p">(</span><span class="n">curr_ctx_id</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;loop_type&quot;</span><span class="p">]:</span>
                        <span class="c1"># HPCViewer only puts loops in CCT, but not trace view, so</span>
                        <span class="c1"># we use a special Loop Enter/Leave event type</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Loop Enter&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Enter&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Process&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;RANK&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Thread&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;THREAD&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Host&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;NODE&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Core&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;CORE&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry_node</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Line Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Calling Context ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_ctx_id</span><span class="p">)</span>

            <span class="n">last_node</span> <span class="o">=</span> <span class="n">current_node</span>
            <span class="n">last_id</span> <span class="o">=</span> <span class="n">context_id</span>

        <span class="c1"># Now we want to close all the &quot;enter&quot; events from the last sample</span>
        <span class="n">current_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_stamp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_time_stamp</span>
        <span class="k">if</span> <span class="n">last_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">common_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">common_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">get_intersection</span><span class="p">(</span><span class="n">last_node</span><span class="p">)</span>

            <span class="c1"># closing each &quot;enter&quot; column until we reach the common_node</span>
            <span class="k">while</span> <span class="n">last_node</span> <span class="o">!=</span> <span class="n">common_node</span><span class="p">:</span>
                <span class="n">curr_ctx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">nid_to_ctx</span><span class="p">[</span><span class="n">last_node</span><span class="o">.</span><span class="n">_pipit_nid</span><span class="p">]</span>
                <span class="n">context_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">get_information_from_context_id</span><span class="p">(</span>
                    <span class="n">curr_ctx_id</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;loop_type&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Loop Leave&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Leave&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Process&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;RANK&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Thread&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;THREAD&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Host&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;NODE&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Core&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;CORE&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Source File Line Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_information</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Calling Context ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_ctx_id</span><span class="p">)</span>
                <span class="n">last_node</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">parent</span></div>


<div class="viewcode-block" id="HPCToolkitReader"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.HPCToolkitReader">[docs]</a><span class="k">class</span> <span class="nc">HPCToolkitReader</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="p">:</span> <span class="n">MetaReader</span> <span class="o">=</span> <span class="n">MetaReader</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/meta.db&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_reader</span> <span class="o">=</span> <span class="n">ProfileReader</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/profile.db&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_reader</span> <span class="o">=</span> <span class="n">TraceReader</span><span class="p">(</span>
            <span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/trace.db&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_reader</span>
        <span class="p">)</span>

<div class="viewcode-block" id="HPCToolkitReader.read"><a class="viewcode-back" href="../../../source/pipit.readers.html#pipit.readers.hpctoolkit_reader.HPCToolkitReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pipit</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">:</span>
        <span class="n">trace_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_reader</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Need to sort df by timestamp then index</span>
        <span class="c1"># (since many events occur at the same timestamp)</span>

        <span class="c1"># rename the index axis, so we can sort with it</span>
        <span class="n">trace_df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># sort by timestamp then index</span>
        <span class="n">trace_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">trace_df</span> <span class="o">=</span> <span class="n">trace_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Event Type&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Thread&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Process&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># cct is needed to create trace in hpctoolkit,</span>
        <span class="c1"># so always return it as part of the trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_df</span> <span class="o">=</span> <span class="n">trace_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pipit</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_reader</span><span class="o">.</span><span class="n">cct</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Parallel Software and Systems Group, University of Maryland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>